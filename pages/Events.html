<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Events Page</title>

    <link rel="stylesheet" href="../css/headerFooter.css" />
    <link rel="stylesheet" href="../css/SideBar.css" />
    <link rel="stylesheet" href="../css/events.css" />
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="../js/ajaxcalls.js"></script>
    <script src="../js/map.js"></script>
    <script src="../js/events.js"></script>
  </head>

  <body>
    <!-- HEADER -->
    <div class="page-wrapper">
      <!-- HEADER -->
      <header class="main-header">
        <div class="header-container">
          <div class="branding">
            <img src="../images/logo.png" class="site-logo" alt="logo" />
            <h1 class="site-title">Get2Gether</h1>
          </div>
          <button class="menu-toggle" aria-label="×ª×¤×¨×™×˜" onclick="toggleMenu()">
            â˜°
          </button>
          <nav class="main-nav">
            <ul>
              <li><a href="#" id="actionsToggle">×”×¤×¢×•×œ×•×ª ×©×œ×™</a></li>
              <li><a href="dashboard.html">×“×©×‘×•×¨×“</a></li>
              <li><a href="Events.html">×”××™×¨×•×¢×™× ×©×œ×™</a></li>
              <li><a href="map.html">××¤×ª ×”××•×¨×—×™×</a></li>
              <li><a href="#" onclick="logout()">×”×ª× ×ª×§×•×ª</a></li>
            </ul>
          </nav>

          <!-- ×ª×¤×¨×™×˜ ×¦×“×“×™ -->
          <div id="actionsSidebar">
            <span class="close-sidebar" onclick="toggleSidebar()">Ã—</span>
            <ul>
              <li><a href="editEvent.html">âœï¸ ×¢×¨×™×›×ª ×¤×¨×˜×™ ××™×¨×•×¢</a></li>
              <li><a href="UpPage.html">ğŸ˜Š ×§×•×‘×¥ ××•×–×× ×™×</a></li>
              <li><a href="shuttle.html">ğŸšŒ ×”×§××ª ×”×¡×¢×”</a></li>
              <li><a href="MyShuttle.html">ğŸ‘ï¸ ×¦×¤×™×™×” ×‘×”×¡×¢×” ×§×™×™××ª</a></li>
              <li><a href="login.html">ğŸ”´ ×”×ª× ×ª×§×•×ª</a></li>
            </ul>
          </div>
        </div>
      </header>

      <!-- HERO BANNER -->
      <section class="hero">
        <h1>×”××™×¨×•×¢×™× ×©×œ×™</h1>
        <p>Get2Gether ×ª××¦××• ××ª ×›×œ ×”××™×¨×•×¢×™× ×©×”×•×–×× ×ª ××œ×™×”× ×“×¨×š</p>
      </section>

      <!-- ×¨×©×™××ª ×”××™×¨×•×¢×™× -->
      <section class="about">
        <div class="events-list" id="eventsContainer">
          <!-- ×›××Ÿ × ×¨× ×“×¨ ×“×™× ×××™×ª ××ª ×”××™×¨×•×¢×™× -->
        </div>
      </section>

      <!-- FOOTER -->
      <footer class="main-footer">
        <div class="footer-container">
          <p>×¦×•×¨ ×§×©×¨:</p>
          <div class="footer-links">
            <a href="https://www.instagram.com" target="_blank">××™× ×¡×˜×’×¨×</a> |
            <a href="https://wa.me/" target="_blank">×•×•××˜×¡××¤</a> |
            <a href="mailto:igroup2project@gmail.com">××™××™×™×œ</a>
          </div>
        </div>
      </footer>
    </div>

    <script>
      $(document).ready(function () {
        // ×”×¡×ª×¨×ª ×”-NAVBAR ×× ×”××©×ª××© ×”×•× Guest
        if (localStorage.getItem("Role") === "Guest") {
          $(".main-nav").hide();
        }
        // ×©×œ×™×¤×ª personID ××”-localStorage
        const personID = localStorage.getItem("personID");
        if (!personID) {
          $("#eventsContainer").html("<p>×œ× × ××¦× ××–×”×” ××©×ª××© ×‘××¢×¨×›×ª</p>");
          return;
        }
        const api = "https://localhost:7035/api/";
        ajaxCall(
          "GET",
          api + `Events/${personID}`,
          null,
          function (events) {
            console.log("âœ… Events loaded");
            const container = $("#eventsContainer");
            container.empty(); // × ×§×” ×× ×™×© ××©×”×•

            events.forEach((event) => {
              const date = new Date(event.eventDate).toLocaleDateString(
                "he-IL"
              );

              const status = event.numOfGuest > 30 ? "××•×©×¨" : "×××ª×™×Ÿ ×œ××™×©×•×¨";

              const cardHtml = `
                <div class="event-card">
                  <h3>${event.eventDesc}</h3>
                  <p><strong>×ª××¨×™×š:</strong> ${date}</p>
                  <p><strong>××™×§×•×:</strong> ${event.eventLocation}</p>
                </div>
              `;

              container.append(cardHtml);
            });
          },
          function (err) {
            console.error("âŒ Error loading events", err);
            $("#eventsContainer").html("<p>××™×¨×¢×” ×©×’×™××” ×‘×˜×¢×™× ×ª ×”××™×¨×•×¢×™×</p>");
          }
        );
      });
    </script>
  </body>
</html>
