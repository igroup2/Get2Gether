<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="/css/style.css" />
    <script src="/js/Games.js"></script>
    <script
      src="https://code.jquery.com/jquery-3.7.1.min.js"
      integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
      crossorigin="anonymous"
    ></script>
    <script src="/js/ajaxcalls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
      $(document).ready(function () {
        console.log("Document ready!");
        $("#registerForm").submit((event) => {
          event.preventDefault();
          console.log("Form submitted!"); // בדוק אם הפונקציה פועלת
          submitToServer(); // קריאה לפונקציה
        });

        $("#loginForm").submit((event) => {
          event.preventDefault();
          console.log("Form login submitted!"); // בדוק אם הפונקציה פועלת
          Login(); // קריאה לפונקציה
        });
      });

      function submitToServer() {
        console.log("submit");
        let user = {
          id: $("#registerId").val(),
          name: $("#registerName").val(),
          email: $("#registerEmail").val(),
          password: $("#registerPassword").val(),
        };

        const api = "https://proj.ruppin.ac.il/igroup2/prod/api/Users";
        console.log(user);
        ajaxCall(
          "POST",
          api,
          JSON.stringify(user),
          POSTUsersSCB(user),
          POSTUsersECB
        );
        return false;
      }

      function POSTUsersSCB(user) {
  Swal.fire({
    position: "center",
    icon: "success",
    title: "Congratulations "+user.name+"! Your account has been successfully created.",
    showConfirmButton: false,
    timer: 3000
  }).then(() => {
    // לאחר סיום ההודעה חוזרים ל-LOGIN
    $("#DivReg").hide();
    $("#DivLogIn").show();
  });
}



      function POSTUsersECB(err) {
        console.log(err);
      }

      function Login() {
        console.log("try to log in");
        let user = {
          id: 0,
          name: "",
          email: $("#loginEmail").val(),
          password: $("#loginPassword").val(),
        };

        const api = "https://proj.ruppin.ac.il/igroup2/prod/api/Users/login";
        console.log(user);
        ajaxCall(
          "POST",
          api,
          JSON.stringify(user),
          POSTUsersLogSCB,
          POSTUsersLogECB
        );
        return false;
      }

      function POSTUsersLogSCB() {
  Swal.fire({
    position: "center",
    icon: "success",
    title: "Welcome to SteamStore Website",
    showConfirmButton: false,
    timer: 3000}).then(() => {
    window.location.href = "index.html";
  });
}

      function POSTUsersLogECB(err) {
        console.log(err);
      }

      $(document).on("input", "#registerPassword", function () {
        console.log("enter to the input");
        var pattern = new RegExp($(this).attr("pattern"));
        var value = $(this).val();
        var message =
          "בבקשה הזן סיסמה בפורמט המבוקש: רק אותיות גדולות באנגלית ומספרים, לפחות 5 תווים.";
        this.setCustomValidity(value.match(pattern) ? "" : message);
      });
    </script>

    <script>
      $(document).ready(function () {
        console.log("Document ready!");

        // מעבר לטופס הרשמה
        $("#showRegisterForm").click(() => {
          $("#DivLogIn").hide();
          $("#DivReg").show();
        });

        // מעבר לטופס התחברות
        $("#showLoginForm").click(() => {
          $("#DivReg").hide();
          $("#DivLogIn").show();
        });
      });
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const backgroundCarousel = document.querySelector(
          ".background-carousel"
        );

        // שליפת תמונות מתוך המערך
        const images = GAME.flatMap(
          (game) => game.Screenshots.split(",").slice(0, 2) // בוחר עד 2 תמונות מכל משחק
        );

        let currentIndex = 0;

        // הוספת כל התמונות לקרוסלה
        images.forEach((imageUrl) => {
          const img = document.createElement("img");
          img.src = imageUrl.trim();
          backgroundCarousel.appendChild(img);
        });

        const carouselImages = document.querySelectorAll(
          ".background-carousel img"
        );

        // הפעלת הקרוסלה
        function changeImage() {
          carouselImages.forEach((img, index) => {
            img.style.opacity = index === currentIndex ? "1" : "0";
          });
          currentIndex = (currentIndex + 1) % carouselImages.length; // מעבר לתמונה הבאה
        }

        setInterval(changeImage, 5000); // שינוי תמונה כל 5 שניות
        changeImage(); // התחלה מיידית
      });
    </script>
  </head>
  <body>
    <div class="background-carousel"></div>
    <div class="container">
      <h1 class="forms">Welcome to Steam Store</h1>
      <div class="form-container">
        <div id="DivLogIn">
          <!-- טופס התחברות -->
          <form id="loginForm">
            <h2>Login</h2>
            <label>Email:</label>
            <input
              type="email"
              id="loginEmail"
              placeholder="Enter your email"
              required
            />

            <label>Password:</label>
            <input
              type="password"
              id="loginPassword"
              placeholder="Enter your password"
              pattern="^(?=.*[A-Z])(?=.*[0-9])[A-Z0-9]{5,}$"
              required
            />

            <button type="submit">Login</button>
          </form>
          <button id="showRegisterForm">Register</button>
        </div>
        <!-- טופס הרשמה -->
        <div id="DivReg" style="display: none">
          <form id="registerForm">
            <h2>Register</h2>

            <label>ID:</label>
            <input
              type="number"
              id="registerId"
              placeholder="Enter an ID"
              required
            />

            <label>Name:</label>
            <input
              type="text"
              id="registerName"
              placeholder="Enter your Name"
              required
            />

            <label>Email:</label>
            <input
              type="email"
              id="registerEmail"
              placeholder="Enter your email"
              required
            />

            <label>Password:</label>
            <input
              type="password"
              id="registerPassword"
              placeholder="Enter a password (Uppercase and Numbers)"
              pattern="^(?=.*[A-Z])(?=.*[0-9])[A-Z0-9]{5,}$"
              required
            />

            <button>Register</button>
          </form>
          <button id="showLoginForm">Back to Login</button>
        </div>
      </div>
    </div>
  </body>
</html>
